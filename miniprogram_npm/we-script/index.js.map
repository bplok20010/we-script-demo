{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/index.ts","webpack:///./src/utils.ts","webpack:///external \"eval5\"","webpack:///./src/adapter.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","import { evalScript, loadScript, hasRunInContext, setRunInContext, globalContext } from \"./utils\";\n\nconst PENDING = 0;\nconst COMPLETED = 1;\n\nfunction attached(this: any) {\n\tconst { src, timeout, cache, text, once } = this.data;\n\tlet context: any = globalContext;\n\n\tlet isInit = true;\n\n\tthis.triggerEvent(\"onInit\", {\n\t\tgetContext() {\n\t\t\treturn context;\n\t\t},\n\t\tsetContext(ctx: Record<any, any>) {\n\t\t\tif (!isInit) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcontext = ctx;\n\t\t},\n\t});\n\n\tisInit = false;\n\n\tif (text) {\n\t\tPromise.resolve()\n\t\t\t.then(() => {\n\t\t\t\tevalScript(text, context);\n\n\t\t\t\tthis.triggerEvent(\"onLoad\", {\n\t\t\t\t\tcontext,\n\t\t\t\t});\n\n\t\t\t\tthis.setData({\n\t\t\t\t\tloadStatus: COMPLETED,\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((e) => {\n\t\t\t\tthis.triggerEvent(\"onError\", { error: e });\n\t\t\t});\n\t\treturn;\n\t}\n\n\tif (!src) {\n\t\tthis.triggerEvent(\"onLoad\", {\n\t\t\tcontext,\n\t\t});\n\t\treturn;\n\t}\n\n\tconst scriptUrls = Array.isArray(src) ? src : [src];\n\n\tconst promises = scriptUrls.map((url) => {\n\t\treturn loadScript(\n\t\t\t{\n\t\t\t\turl,\n\t\t\t\ttimeout,\n\t\t\t\tmethod: \"GET\",\n\t\t\t},\n\t\t\tcache\n\t\t);\n\t});\n\n\tPromise.all(promises)\n\t\t.then((codes) => {\n\t\t\tcodes.forEach((code) => {\n\t\t\t\tif (!(once && hasRunInContext(context, code.url))) {\n\t\t\t\t\tevalScript(code.data, context);\n\t\t\t\t\tsetRunInContext(context, code.url);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.triggerEvent(\"onLoad\", {\n\t\t\t\tcontext,\n\t\t\t});\n\n\t\t\tthis.setData({\n\t\t\t\tloadStatus: COMPLETED,\n\t\t\t});\n\t\t})\n\t\t.catch((e) => {\n\t\t\tthis.triggerEvent(\"onError\", { error: e });\n\t\t});\n}\n\nComponent({\n\tproperties: {\n\t\tsrc: {\n\t\t\ttype: String,\n\t\t\toptionalTypes: [String, Array],\n\t\t},\n\t\ttext: String,\n\t\t// 无效\n\t\ttype: String,\n\t\t// 无效\n\t\tcontext: {\n\t\t\ttype: Object,\n\t\t\tvalue: globalContext,\n\t\t},\n\t\ttimeout: {\n\t\t\ttype: Number,\n\t\t\tvalue: 60000,\n\t\t},\n\t\tcache: {\n\t\t\ttype: Boolean,\n\t\t\tvalue: true,\n\t\t},\n\t\tonce: {\n\t\t\ttype: Boolean,\n\t\t\tvalue: true,\n\t\t},\n\t},\n\tdata: {\n\t\tloadStatus: PENDING,\n\t\tPENDING,\n\t\tCOMPLETED,\n\t},\n\tlifetimes: {\n\t\tattached,\n\t},\n\tattached,\n});\n","import { Interpreter } from \"eval5\";\r\nimport { request, requestOptions, SuccessCallbackResult, FailCallbackResult } from \"./adapter\";\r\n\r\nconst loadCachedScript: Record<string, string> = Object.create(null);\r\n\r\nconst SCRIPT_EXEC_TIMEOUT = 600000;\r\n\r\n// 基本方法注入\r\nconst rootContext = {\r\n\tconsole,\r\n\tsetTimeout,\r\n\tclearTimeout,\r\n\tsetInterval,\r\n\tclearInterval,\r\n\twx: typeof wx === \"undefined\" ? undefined : wx,\r\n};\r\n\r\nexport const globalContext: Record<any, any> = {};\r\n\r\nexport function evalScript<T extends Record<any, any>>(code: string, context?: T) {\r\n\tif (!code) return;\r\n\r\n\tconst interpreter = new Interpreter(context || globalContext, {\r\n\t\ttimeout: SCRIPT_EXEC_TIMEOUT,\r\n\t\trootContext: rootContext,\r\n\t\tglobalContextInFunction: context || globalContext,\r\n\t});\r\n\r\n\tinterpreter.evaluate(code);\r\n\r\n\treturn interpreter.getValue();\r\n}\r\n\r\nexport function loadScript(requestOpts: requestOptions, useCache = true) {\r\n\tconst url = requestOpts.url;\r\n\r\n\treturn new Promise<{\r\n\t\turl: string;\r\n\t\tdata: string;\r\n\t}>((resolve, reject) => {\r\n\t\tif (useCache && url in loadCachedScript) {\r\n\t\t\tresolve({\r\n\t\t\t\turl,\r\n\t\t\t\tdata: loadCachedScript[url],\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\trequest(\r\n\t\t\tObject.assign({}, requestOpts, {\r\n\t\t\t\tsuccess(res: SuccessCallbackResult) {\r\n\t\t\t\t\tloadCachedScript[url] = res.data;\r\n\t\t\t\t\tresolve({\r\n\t\t\t\t\t\turl,\r\n\t\t\t\t\t\tdata: res.data,\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tfail(err: FailCallbackResult) {\r\n\t\t\t\t\treject(new Error(err.errMsg));\r\n\t\t\t\t},\r\n\t\t\t})\r\n\t\t);\r\n\t});\r\n}\r\n\r\ninterface RunCache {\r\n\t__weScriptRunCache__: Record<string, boolean>;\r\n}\r\n\r\nexport function hasRunInContext(ctx: Record<any, any> & RunCache, url: string) {\r\n\treturn ctx && ctx.__weScriptRunCache__ && ctx.__weScriptRunCache__[url];\r\n}\r\n\r\nexport function setRunInContext(ctx: Record<any, any> & RunCache, url: string) {\r\n\tif (!ctx) return;\r\n\r\n\tif (!ctx.__weScriptRunCache__) {\r\n\t\tObject.defineProperty(ctx, \"__weScriptRunCache__\", {\r\n\t\t\tenumerable: false,\r\n\t\t\tvalue: Object.create(null),\r\n\t\t});\r\n\t}\r\n\tctx.__weScriptRunCache__[url] = true;\r\n}\r\n","module.exports = require(\"eval5\");","/**\r\n * lib.wx.api.d.ts\r\n */\r\ntype IAnyObject = Record<string, any>;\r\n\r\ntype RequestFailCallback = (res: GeneralCallbackResult) => void;\r\n\r\ninterface RequestSuccessCallbackResult {\r\n\tdata: string | IAnyObject | ArrayBuffer;\r\n\theader: IAnyObject;\r\n\tstatusCode: number;\r\n\terrMsg: string;\r\n}\r\n\r\ntype RequestSuccessCallback = (result: RequestSuccessCallbackResult) => void;\r\n\r\ninterface GeneralCallbackResult {\r\n\terrMsg: string;\r\n}\r\n\r\ntype RequestCompleteCallback = (res: GeneralCallbackResult) => void;\r\n\r\nexport interface requestOptions {\r\n\t/** 开发者服务器接口地址 */\r\n\turl: string;\r\n\t/** 接口调用结束的回调函数（调用成功、失败都会执行） */\r\n\tcomplete?: RequestCompleteCallback;\r\n\t/** 请求的参数 */\r\n\tdata?: string | IAnyObject | ArrayBuffer;\r\n\tmode?: any; // 微信小程序无效\r\n\tcredentials?: any; // 微信小程序无效\r\n\ttimeout?: number;\r\n\t/** 返回的数据格式\r\n\t *\r\n\t * 可选值：\r\n\t * - 'json': 返回的数据为 JSON，返回后会对返回的数据进行一次 JSON.parse;\r\n\t * - '其他': 不对返回的内容进行 JSON.parse; */\r\n\tdataType?: \"json\" | \"其他\";\r\n\t/** 接口调用失败的回调函数 */\r\n\tfail?: RequestFailCallback;\r\n\t/** 设置请求的 header，header 中不能设置 Referer。\r\n\t *\r\n\t * `content-type` 默认为 `application/json` */\r\n\theader?: IAnyObject;\r\n\t/** HTTP 请求方法\r\n\t *\r\n\t * 可选值：\r\n\t * - 'OPTIONS': HTTP 请求 OPTIONS;\r\n\t * - 'GET': HTTP 请求 GET;\r\n\t * - 'HEAD': HTTP 请求 HEAD;\r\n\t * - 'POST': HTTP 请求 POST;\r\n\t * - 'PUT': HTTP 请求 PUT;\r\n\t * - 'DELETE': HTTP 请求 DELETE;\r\n\t * - 'TRACE': HTTP 请求 TRACE;\r\n\t * - 'CONNECT': HTTP 请求 CONNECT; */\r\n\tmethod?: \"OPTIONS\" | \"GET\" | \"HEAD\" | \"POST\" | \"PUT\" | \"DELETE\" | \"TRACE\" | \"CONNECT\";\r\n\t/** 响应的数据类型\r\n\t *\r\n\t * 可选值：\r\n\t * - 'text': 响应的数据为文本;\r\n\t * - 'arraybuffer': 响应的数据为 ArrayBuffer;\r\n\t *\r\n\t * 最低基础库： `1.7.0` */\r\n\tresponseType?: \"text\" | \"arraybuffer\";\r\n\t/** 接口调用成功的回调函数 */\r\n\tsuccess?: RequestSuccessCallback;\r\n}\r\n\r\nexport type SuccessCallbackResult = RequestSuccessCallbackResult & {\r\n\tdata: string;\r\n};\r\nexport type FailCallbackResult = GeneralCallbackResult;\r\n\r\nexport function request(options: requestOptions) {\r\n\twx.request(options);\r\n}\r\n"],"sourceRoot":""}